From eb542fe9c56cf9c8e1f8eb100947cd3644047cd0 Mon Sep 17 00:00:00 2001
From: Jacob McSwain <jacob@mcswain.dev>
Date: Sun, 2 Jul 2023 04:22:36 -0500
Subject: [PATCH 15/15] Improved bad route handling

---
 src/linux/kernel_routes_nl.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/src/linux/kernel_routes_nl.c b/src/linux/kernel_routes_nl.c
index 22ed9f59..2b46d4b4 100644
--- a/src/linux/kernel_routes_nl.c
+++ b/src/linux/kernel_routes_nl.c
@@ -464,6 +464,14 @@ int olsr_new_netlink_route(unsigned char family, uint32_t rttable, unsigned int
     if (!set && errno == 11 && if_ifwithindex(if_index) == NULL) {
       err = 0;
     }
+    /* Failed to delete a route on a non-existant device - ignore the error so the route will be successfully remove from internal state */
+    if (!set && errno == 11 && if_ifwithindex(if_index) == NULL) {
+      err = 0;
+    }
+    /* Failed to add a route - ignore the error to avoid this happening continually */
+    else if (set && errno == 11) {
+      err = 0;
+    }
   }
 
   return err;
-- 
2.41.0

